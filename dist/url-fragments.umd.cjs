(function(i,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(i=typeof globalThis<"u"?globalThis:i||self,a(i.urlFragments={}))})(this,(function(i){"use strict";const a=function(f={}){let s=new URLSearchParams(window.location.hash.substr(1));const o=f.stores||"*";let n,u,c="",h,m={};const b=100,y=function(){let e=s.toString();e!==c&&(c=e,history.pushState(null,"",`#${e}`))},S=function(){clearTimeout(u),u=setTimeout(y,b)},w=function(){for(let[e,t]of s.entries())if(o==="*"||o.includes(e)){let r;try{r=JSON.parse(t)}catch(l){if(l instanceof SyntaxError)r=t,console.warn(`urlFragments: could not parse JSON value for ${e} in URL hash: ${t}`);else throw l}n.stores[e]?n.stores[e](r):n.store(e,r)}},T=function(e){for(let t in e)if((o==="*"||o.includes(t))&&!m[t]){const r=e[t];m[t]=r(l=>{const v=JSON.stringify(l);s.get(t)!==v&&(s.set(t,v),S())})}},g=function(e){s=new URLSearchParams(window.location.hash.substr(1)),w()},p=function(e){console.log("windowMessage",e),e.data.message==="updateHash"&&(window.location=e.data.value)};this.init=function(e){n=e,w(),h=n.newstoreadded(t=>{T(n.stores)}),window.addEventListener("popstate",g),window.addEventListener("message",p)},this.destroy=function(){window.removeEventListener("popstate",p),window.removeEventListener("popstate",g),h()}};class d extends HTMLElement{constructor(){super(),this.plugin=null,this.viewer=null,console.log("url-fragments init")}connectedCallback(){console.log("url-fragments connected");const s=this.closest("geocam-viewer");if(!s){console.error("GeocamViewerUrlFragments must be a child of GeocamViewer");return}const o=()=>{const n=s.viewer;if(n&&typeof n.plugin=="function"){if(this.plugin)return;this.viewer=n;const c=(this.getAttribute("params")||"").split(",");this.plugin=new a({stores:c}),this.viewer.plugin(this.plugin)}else setTimeout(o,50)};o()}disconnectedCallback(){this.plugin&&typeof this.plugin.destroy=="function"&&this.plugin.destroy(),this.plugin=null,this.viewer=null,console.log("url-fragments disconnected")}}window.customElements.define("geocam-viewer-url-fragments",d),i.GeocamViewerUrlFragments=d,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));
