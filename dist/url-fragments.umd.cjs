(function(n,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.urlFragments={}))})(this,function(n){"use strict";const i=function(g={}){let a=new URLSearchParams(window.location.hash.substr(1));const r=g.stores||"*";let s,u,c="",l,f={};const S=100,b=function(){let e=a.toString();e!==c&&(c=e,console.log("pushing state",e),history.pushState(null,"",`#${e}`))},v=function(){clearTimeout(u),u=setTimeout(b,S)},h=function(){for(let[e,t]of a.entries())if(r==="*"||r.includes(e)){let o;try{o=JSON.parse(t)}catch(d){if(d instanceof SyntaxError)o=t,console.warn(`urlFragments: could not parse JSON value for ${e} in URL hash: ${t}`);else throw d}s.stores[e]?s.stores[e](o):s.store(e,o)}},y=function(e){for(let t in e)if((r==="*"||r.includes(t))&&!f[t]){const o=e[t];f[t]=o(d=>{const m=JSON.stringify(d);a.get(t)!==m&&(a.set(t,m),v())})}},w=function(e){a=new URLSearchParams(window.location.hash.substr(1)),h()},p=function(e){console.log("windowMessage",e),e.data.message==="updateHash"&&(window.location=e.data.value)};this.init=function(e){s=e,h(),l=s.newstoreadded(t=>{y(s.stores)}),window.addEventListener("popstate",w),window.addEventListener("message",p)},this.destroy=function(){window.removeEventListener("popstate",p),window.removeEventListener("popstate",w),l()}};n.urlFragments=i,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
