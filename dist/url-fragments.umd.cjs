(function(o,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(o=typeof globalThis<"u"?globalThis:o||self,a(o.urlFragments={}))})(this,function(o){"use strict";const a=function(u={}){let n=new URLSearchParams(window.location.hash.substr(1));const r=u.stores||"*";let s,d,f="",h,m={};const v=100,S=function(){let e=n.toString();e!==f&&(f=e,console.log("pushing state",e),history.pushState(null,"",`#${e}`))},y=function(){clearTimeout(d),d=setTimeout(S,v)},w=function(){for(let[e,t]of n.entries())if(r==="*"||r.includes(e)){let i;try{i=JSON.parse(t)}catch(c){if(c instanceof SyntaxError)i=t,console.warn(`urlFragments: could not parse JSON value for ${e} in URL hash: ${t}`);else throw c}s.stores[e]?s.stores[e](i):s.store(e,i)}},T=function(e){for(let t in e)if((r==="*"||r.includes(t))&&!m[t]){const i=e[t];m[t]=i(c=>{const b=JSON.stringify(c);n.get(t)!==b&&(n.set(t,b),y())})}},g=function(e){n=new URLSearchParams(window.location.hash.substr(1)),w()},p=function(e){console.log("windowMessage",e),e.data.message==="updateHash"&&(window.location=e.data.value)};this.init=function(e){s=e,w(),h=s.newstoreadded(t=>{T(s.stores)}),window.addEventListener("popstate",g),window.addEventListener("message",p)},this.destroy=function(){window.removeEventListener("popstate",p),window.removeEventListener("popstate",g),h()}};class l extends HTMLElement{constructor(){super(),this.plugin=null,console.log("url-fragments init")}connectedCallback(){console.log("url-fragments connected");const n=this.parentNode;if(n.viewer&&n.viewer.plugin){const s=(this.getAttribute("params")||"").split(",");this.plugin=new a({stores:s}),n.viewer.plugin(this.plugin)}else console.error("GeocamViewerUrlFragments must be a child of GeocamViewer")}disconnectedCallback(){this.plugin=null,console.log("url-fragments disconnected")}}window.customElements.define("geocam-viewer-url-fragments",l),o.GeocamViewerUrlFragments=l,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
